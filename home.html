<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>T√¥comfome üçî | Buscar</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  
<link rel="icon" type="image/ico" href="img/Logo.png">

<style>
:root{
  --laranja:#ff8c1a;
  --laranja-escuro:#e67300;
  --cinza:#f7f7f7;
  --texto:#333;
  --sombra:rgba(0,0,0,.08);
}

*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:'Segoe UI',Arial,sans-serif;
}

body{
  background:var(--cinza);
  padding-bottom:95px;
}

/* HEADER */
.header{
  background:#fff;
  padding:14px;
  display:flex;
  align-items:center;
  gap:10px;
  box-shadow:0 3px 8px var(--sombra);
  position:sticky;
  top:0;
  z-index:5;
}

.menu-btn img{
  width:26px;
  cursor:pointer;
}

.header input{
  flex:1;
  padding:12px 14px;
  border-radius:14px;
  border:1.4px solid #ddd;
  font-size:.9em;
}

.header input:focus{
  outline:none;
  border-color:var(--laranja);
}

.usuario{
  font-size:.8em;
  font-weight:700;
  color:var(--laranja);
}

/* ENDERE√áO */
.endereco{
  background:#fff;
  padding:12px 16px;
  display:flex;
  align-items:center;
  gap:10px;
  font-size:.9em;
  box-shadow:0 2px 6px var(--sombra);
  color:#666;
  margin-bottom:10px;
}

.endereco .icon{
  width:22px;
}

/* SIDEBAR */
.sidebar{
  position:fixed;
  top:0;
  left:-260px;
  width:260px;
  height:100%;
  background:#fff;
  box-shadow:2px 0 12px rgba(0,0,0,.2);
  padding:20px;
  transition:.3s;
  z-index:10;
}

.sidebar.active{ left:0; }

.sidebar h3{
  color:var(--laranja);
  margin-bottom:16px;
  display:flex;
  align-items:center;
  gap:8px;
}

.sidebar h3 img{ width:20px; }

.sidebar a{
  display:block;
  padding:12px 0;
  color:var(--texto);
  text-decoration:none;
  border-bottom:1px solid #eee;
  font-weight:500;
}

/* OVERLAY */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  opacity:0;
  pointer-events:none;
  transition:.3s;
  z-index:9;
}

.overlay.active{
  opacity:1;
  pointer-events:auto;
}

/* CARROSSEL */
.carrossel{
  padding:10px 0;
}

.carrossel-track{
  display:flex;
  gap:14px;
  overflow-x:auto;
  padding:0 16px;
}

.carrossel-track img{
  width:240px;
  height:120px;
  object-fit:cover;
  border-radius:18px;
  flex-shrink:0;
  box-shadow:0 6px 14px var(--sombra);
}

/* LISTA */
.lista{
  padding:16px;
}

/* CARD COM√âRCIO */
.card-comercio{
  background:#fff;
  border-radius:20px;
  padding:14px;
  margin-bottom:18px;
  display:flex;
  gap:14px;
  box-shadow:0 6px 16px var(--sombra);
  transition:transform .2s ease;
}

.card-comercio:hover{
  transform:translateY(-2px);
}

.card-comercio img{
  width:92px;
  height:92px;
  border-radius:16px;
  object-fit:cover;
}

.card-comercio h4{
  font-size:1.05em;
  margin-bottom:4px;
}

.card-comercio .tipo{
  font-size:.8em;
  color:#777;
}

.card-comercio .local{
  font-size:.75em;
  color:#aaa;
  margin:6px 0 10px;
}

.btn{
  width:100%;
  padding:10px;
  border:none;
  border-radius:14px;
  background:linear-gradient(135deg,var(--laranja),var(--laranja-escuro));
  color:#fff;
  font-weight:700;
  cursor:pointer;
}

/* MENU INFERIOR ‚Äì SEM ESTADO, S√ì UX */
.menu-inferior{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:#fff;
  display:flex;
  justify-content:space-around;
  padding:12px 0 10px;
  box-shadow:0 -6px 18px rgba(0,0,0,.14);
  border-top:1px solid #eee;
  z-index:5;
}

.menu-inferior div{
  flex:1;
  text-align:center;
  font-size:.75em;
  color:#777;
  cursor:pointer;
  transition:transform .15s ease, opacity .15s ease;
}

.menu-inferior .icon{
  width:26px;
  display:block;
  margin:0 auto 5px;
  filter:brightness(1); /* √≠cones laranja */
  transition:transform .15s ease;
}

/* FEEDBACK DE TOQUE */
.menu-inferior div:active{
  transform:scale(.92);
  opacity:.85;
}

.menu-inferior div:active .icon{
  transform:translateY(-3px);
}

/* CHAT */
#chat-balao{
  position:fixed;
  bottom:90px;
  right:18px;
  background:linear-gradient(135deg,var(--laranja),var(--laranja-escuro));
  color:#fff;
  padding:14px 18px;
  border-radius:50px;
  font-weight:700;
  cursor:pointer;
  box-shadow:0 6px 18px rgba(0,0,0,.25);
  display:flex;
  align-items:center;
  gap:8px;
}

#chat-balao img{
  width:20px;
}
/* Remove barra de rolagem do carrossel */
.carrossel-track{
  scrollbar-width: none;          /* Firefox */
  -ms-overflow-style: none;       /* IE / Edge antigo */
}

.carrossel-track::-webkit-scrollbar{
  display: none;                  /* Chrome / Safari */
}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
  <h3><img src="img/menu.png"> Menu</h3>

  <a href="#" onclick="filtrarTipoComercio('Hamburgueria')">Hamburgueria</a>
  <a href="#" onclick="filtrarTipoComercio('Pizzaria')">Pizzaria</a>
  <a href="#" onclick="filtrarTipoComercio('Pastelaria')">Pastelaria</a>
  <a href="#" onclick="filtrarTipoComercio('A√ßai / Sorveteria')">A√ßai / Sorveteria</a>
  <a href="#" onclick="filtrarTipoComercio('Lanchonete')">Lanchonete</a>

  <a href="#" onclick="irPerfil();fecharMenu()">Meu Perfil</a>
  <a href="#" onclick="logoff()">Sair</a>
</div>

<div class="overlay" id="overlay" onclick="fecharMenu()"></div>

<!-- HEADER -->
<div class="header">
  <div class="menu-btn" onclick="toggleMenu()">
    <img src="img/menu.png">
  </div>
  <input id="buscaInput" placeholder="Buscar restaurantes ou comidas...">
  <div class="usuario">Ol√° novamente.</div>
</div>

<!-- ENDERE√áO -->
<div class="endereco">
  <img src="img/endereco.png" class="icon">
  <span>Entregar em <strong>Colina - SP</strong></span>
</div>

<!-- CARROSSEL -->
<div class="carrossel">
  <div class="carrossel-track">
    <img src="img/banner1.jpg">
    <img src="img/banner2.jpg">
    <img src="img/banner3.jpg">
  </div>
</div>

<!-- LISTA -->
<div class="lista" id="listaProdutos"></div>

<!-- MENU INFERIOR -->
<div class="menu-inferior">
  <div onclick="irInicio()">
    <img src="img/home.png" class="icon">In√≠cio
  </div>
  <div onclick="irBusca()">
    <img src="img/buscar.png" class="icon">Buscar
  </div>
  <div onclick="irPedidos()">
    <img src="img/pedidos.png" class="icon">Pedidos
  </div>
  <div onclick="irPerfil()">
    <img src="img/perfil.png" class="icon">Perfil
  </div>
</div>

<!-- CHAT -->
<div id="chat-balao">
  <img src="img/suporte.png">
  Suporte
</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

/* üîß FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyD6a29L24aFSgVjmC7NFGXpdWW4g1uQsio",
  authDomain: "tocomfome-754e1.firebaseapp.com",
  projectId: "tocomfome-754e1"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

/* üîß ELEMENTOS */
const lista = document.getElementById("listaProdutos");
const usuarioEl = document.querySelector(".usuario");
const enderecoEl = document.querySelector(".endereco span");
const sidebar = document.getElementById("sidebar");
const overlay = document.getElementById("overlay");
const buscaInput = document.getElementById("buscaInput");
const chatBalao = document.getElementById("chat-balao");

/* üîß ESTADO */
let comercios = [];

/* =========================
   UTIL
========================= */
const normalizar = (txt = "") =>
  txt.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");

/* =========================
   MENU LATERAL
========================= */
window.toggleMenu = () => {
  sidebar.classList.toggle("active");
  overlay.classList.toggle("active");
};

window.fecharMenu = () => {
  sidebar.classList.remove("active");
  overlay.classList.remove("active");
};

/* =========================
   USU√ÅRIO / ENDERE√áO / TEMA
========================= */
onAuthStateChanged(auth, async (user) => {
  if (user) {
    const snap = await getDoc(doc(db, "clientes", user.uid));
    if (snap.exists()) {
      const dados = snap.data();

      usuarioEl.innerText = dados.nome
        ? dados.nome.split(" ")[0]
        : "Usu√°rio";

      enderecoEl.innerText = dados.endereco
        ? `${dados.endereco.bairro}, ${dados.endereco.cidade}`
        : "Endere√ßo n√£o cadastrado";

      if (dados.tema === "dark") {
        document.body.classList.add("dark-theme");
      } else {
        document.body.classList.remove("dark-theme");
      }
    }
  } else {
    usuarioEl.innerText = "Visitante";
    enderecoEl.innerText = "Endere√ßo n√£o dispon√≠vel";
  }
});

/* =========================
   LOGOFF
========================= */
window.logoff = async () => {
  await signOut(auth);
  window.location.href = "index.html";
};

/* =========================
   BARRA INFERIOR (CORRIGIDA)
========================= */
window.irInicio = () => {
  window.location.href = "home.html";
};

window.irBusca = () => {
  buscaInput?.focus();
};

window.irPedidos = () => {
  window.location.href = "Cliente/pedidos.html";
};

window.irPerfil = () => {
  window.location.href = auth.currentUser
    ? "Cliente/perfil.html/"
    : "Cliente/login-cliente.html/";
};

/* =========================
   CARREGAR COM√âRCIOS
========================= */
async function carregarComercios() {
  lista.innerHTML = "";
  comercios = [];

  const snap = await getDocs(collection(db, "comercios"));

  if (snap.empty) {
    lista.innerHTML =
      "<p style='padding:20px;color:#777'>Nenhum com√©rcio encontrado.</p>";
    return;
  }

  snap.forEach(docSnap => {
    const c = docSnap.data();
    if (!c.ativo) return;

    const comercio = {
      id: docSnap.id,
      nome: c.nome || "",
      tipo: c.tipoComercio || "",
      bairro: c.endereco?.bairro || "",
      cidade: c.endereco?.cidade || "",
      img: c.fotoPerfil || c.logoUrl || "https://images.unsplash.com/photo-1552566626-52f8b828add9"
    };

    comercios.push(comercio);
  });

  renderLista(comercios);
}

/* =========================
   RENDER LISTA
========================= */
function renderLista(listaComercios) {
  lista.innerHTML = "";

  if (!listaComercios.length) {
    lista.innerHTML =
      "<p style='padding:20px;color:#777'>Nenhum com√©rcio encontrado.</p>";
    return;
  }

  listaComercios.forEach(c => {
    lista.innerHTML += `
      <div class="card-comercio">
        <img src="${c.img}">
        <div style="flex:1">
          <h4>${c.nome}</h4>
          <div class="tipo">${c.tipo}</div>
          <div class="local">${c.bairro} ‚Ä¢ ${c.cidade}</div>
          <button class="btn" onclick="abrirComercio('${c.id}')">
            Ver card√°pio
          </button>
        </div>
      </div>
    `;
  });
}

/* =========================
   FILTRO MENU LATERAL ‚úÖ
========================= */
window.filtrarTipoComercio = (tipoMenu) => {
  const tipo = normalizar(tipoMenu);

  const filtrados = comercios.filter(c =>
    normalizar(c.tipo) === tipo
  );

  renderLista(filtrados);
  fecharMenu();
};

/* =========================
   BUSCA
========================= */
buscaInput?.addEventListener("input", () => {
  const termo = normalizar(buscaInput.value);

  const filtrados = comercios.filter(c =>
    normalizar(c.nome).includes(termo) ||
    normalizar(c.tipo).includes(termo) ||
    normalizar(c.bairro).includes(termo) ||
    normalizar(c.cidade).includes(termo)
  );

  renderLista(filtrados);
});

/* =========================
   ABRIR COM√âRCIO
========================= */
window.abrirComercio = (comercioId) => {
  localStorage.setItem(
    "comercioSelecionado",
    JSON.stringify({ comercioId })
  );
  window.location.href = "Comercio/perfil-comercio.html";
};

/* =========================
   CHAT
========================= */
chatBalao?.addEventListener("click", () => {
  window.location.href = auth.currentUser
    ? "Cliente/chat-cliente.html"
    : "Cliente/login-cliente.html";
});

/* =========================
   INIT
========================= */
carregarComercios();
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const track = document.querySelector(".carrossel-track");
  if (!track) return;

  let scrollAmount = 0;
  const scrollStep = 1;
  const delay = 25;
  let autoScroll = true;

  // Auto scroll
  const interval = setInterval(() => {
    if (!autoScroll) return;

    scrollAmount += scrollStep;
    track.scrollLeft = scrollAmount;

    if (track.scrollLeft + track.clientWidth >= track.scrollWidth) {
      scrollAmount = 0;
      track.scrollLeft = 0;
    }
  }, delay);

  // Se o usu√°rio interagir, para o auto scroll
  const stopAutoScroll = () => {
    autoScroll = false;
  };

  track.addEventListener("touchstart", stopAutoScroll, { passive: true });
  track.addEventListener("mousedown", stopAutoScroll);
  track.addEventListener("wheel", stopAutoScroll);
});
</script>

</body>
</html>
