<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>TÃ´comfome ğŸ” | Pedido</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --laranja:#ff8c1a;
  --cinza:#f5f5f5;
  --texto:#333;
  --sombra:rgba(0,0,0,.08);
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Arial;}
body{background:var(--cinza);}

.header{
  background:var(--laranja);
  color:#fff;
  padding:16px;
  text-align:center;
  font-size:1.1em;
  font-weight:600;
  box-shadow:0 2px 8px var(--sombra);
}

.container{
  padding:20px;
}

.card{
  background:#fff;
  border-radius:18px;
  padding:16px;
  box-shadow:0 4px 12px var(--sombra);
}

.card h3{margin-bottom:8px;color:var(--laranja);}
.card p{margin:6px 0;color:#555;}

.status{
  margin:12px 0;
  font-weight:600;
  color:var(--laranja);
}

.botoes{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:16px;
}

.botoes button{
  flex:1;
  padding:12px;
  border:none;
  border-radius:12px;
  font-weight:600;
  cursor:pointer;
  background:#eee;
  color:#333;
}

.botoes button.ativo{
  background:var(--laranja);
  color:#fff;
}
</style>
</head>
<body>

<div class="header">ğŸ“¦ Pedido do Cliente</div>

<div class="container">
  <div class="card" id="pedidoCard">
    <h3 id="produtoNome">Produto</h3>
    <p id="clienteNome">Cliente: ...</p>
    <p id="valor">Valor: ...</p>
    <p class="status" id="status">Status: ...</p>

    <div class="botoes">
      <button id="btnNovo" onclick="atualizarStatus('novo')">ğŸ•’ Novo</button>
      <button id="btnPreparando" onclick="atualizarStatus('preparando')">ğŸ‘¨â€ğŸ³ Preparando</button>
      <button id="btnSaiu" onclick="atualizarStatus('saiu')">ğŸ›µ Saiu</button>
      <button id="btnEntregue" onclick="atualizarStatus('entregue')">âœ… Entregue</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

/* Config Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyD6a29L24aFSgVjmC7NFGXpdWW4g1uQsio",
  authDomain: "tocomfome-754e1.firebaseapp.com",
  projectId: "tocomfome-754e1",
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

/* Elementos */
const produtoNome = document.getElementById("produtoNome");
const clienteNome = document.getElementById("clienteNome");
const valor = document.getElementById("valor");
const statusEl = document.getElementById("status");

/* BotÃµes */
const btns = {
  novo: document.getElementById("btnNovo"),
  preparando: document.getElementById("btnPreparando"),
  saiu: document.getElementById("btnSaiu"),
  entregue: document.getElementById("btnEntregue")
};

/* Recuperar pedido selecionado */
const pedidoId = localStorage.getItem("pedidoSelecionado");

/* Carregar pedido em tempo real */
function carregarPedido(){
  if(!pedidoId){
    statusEl.textContent = "Pedido nÃ£o encontrado";
    return;
  }
  const pedidoRef = doc(db,"pedidos",pedidoId);

  // Escuta em tempo real
  onSnapshot(pedidoRef,(snap)=>{
    if(snap.exists()){
      const p = snap.data();
      produtoNome.textContent = p.produtoNome;
      clienteNome.textContent = "Cliente: " + p.clienteNome;
      valor.textContent = "Valor: R$ " + p.valor;
      statusEl.textContent = "Status: " + (p.status || "novo");

      // Atualiza destaque do botÃ£o ativo
      Object.keys(btns).forEach(k=>btns[k].classList.remove("ativo"));
      if(p.status && btns[p.status]){
        btns[p.status].classList.add("ativo");
      }
    }else{
      statusEl.textContent = "Pedido nÃ£o encontrado";
    }
  });
}

/* Atualizar status */
window.atualizarStatus = async (novoStatus)=>{
  if(!pedidoId) return;
  const pedidoRef = doc(db,"pedidos",pedidoId);
  await updateDoc(pedidoRef,{ status: novoStatus });
}

/* AutenticaÃ§Ã£o */
onAuthStateChanged(auth,(user)=>{
  if(!user){
    window.location.href = "login-comercio.html";
    return;
  }
  carregarPedido();
});
</script>
</body>
</html>
